<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>Wharf sucks - Wharf architecture</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><meta content="Iver" name="author" /><meta content="The project is rotten from the core. It’s difficult to get right, but we need to clean it up before we can be proud of it." name="description" /><meta content="Wharf sucks" property="og:title" /><meta content="Wharf architecture" property="og:site_name" /><meta content="article" property="og:type" /><meta content="wharf-sucks" property="neuron:zettel-id" /><meta content="wharf-sucks" property="neuron:zettel-slug" /><meta content="root" property="neuron:zettel-tag" /><script type="application/ld+json">[]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(251,189,8,0.1)}body nav.bottomPane{background-color:rgba(251,189,8,2.0e-2)}body div#footnotes{border-top-color:#fbbd08}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#fbbd08;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(251,189,8,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><!-- Mermaid  -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
window.addEventListener("load", mermaid.initialize({startOnLoad:true}))
</script>

<!-- Prism.js -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
<!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">Wharf sucks</h1><p>The project is rotten from the core. It’s difficult to get right, but we need to clean it up before we can be proud of it.</p><p>It’s horribly difficult to maintain and to add features.</p><h2 id="motive">Motive</h2><p>It’s easy to create <em><strong>a</strong></em> CI/CD tool, but it’s much harder to create <em><strong>the</strong></em> CI/CD tool.</p><p>Do we want our product to compete with the market, or do we want to make a great product that you actually can weigh pros/cons compared to others?</p><p>Currently, Wharf holds all cons compared to other solutions, such as CircleCI, DigitalOcean, Argo CD, GitLab CI/CD, GitHub Actions, AppVeyor, Jenkins, Azure DevOps…</p><p>The common response from outsiders of Wharf has been:</p><blockquote><p>Oh it’s like <em>(insert any of the above CI/CD solutions here)</em>, but bad.</p></blockquote><h2 id="issues">Issues</h2><ul><li><p>All repos are based on POC’s. Nothing we want to sell or have in production. POC’s are meant to proove that a concept can be achived. All repos looks like a hobby project from someone who just started learning Go, and that’s because it is. Suspision is that the original developer of Wharf did not intend Wharf to be adopted by customers, nor to be further developed in a stable manner.</p></li><li><p>Feature-poor. Project has thousands of hours put into it, and yet its list of features is so close to empty and quality in its infrastructure is close to zero.</p></li><li><p>Convoluted to deploy. It’s a horrible experience trying to deploy Wharf.</p></li><li><p>Logs are stored in a table inside the database instead of on disk.</p></li><li><p>Logs are not stored per-step, but aggregated per-build, so if you start a build that runs 2+ steps simontaneously (which most of our Wharf setups does) then the logs will be completely useless as they are a mess of all the logs from all the different steps, and there’s no way to distinguish between them.</p></li><li><p>Imported projects are referenced by display name and full protocol instead of project ID and host domain name. Example: <code>http://gitlab.com/foo</code> and <code>https://gitlab.com/foo</code> are two completely separate projects to Wharf. If it has the display name <code>Foo</code>, then Go get’s completely confused.</p></li><li><p>Logic to import projects are up to the provider plugins to figure out, duplicated code.</p></li><li><p>List of providers is hardcoded into the frontend.</p></li><li><p>Adding a non-Git based provider is near impossible with the current architecture.</p></li><li><p><code>.wharf-ci.yml</code> syntax is so full of “magic strings” and conventions that it’s very hard for newcomers to understand.</p></li><li><p>Step types property naming convention mixes between kebab-case, snake_case, and camelCasing. Prime example is the <code>nuget-package</code> step type:</p><pre><code class="yaml language-yaml">nuget-package:
  version: 1.0.0
  project-path: src/MyDotNetProject
  skip_duplicate: false
  certificatesMountPath: /usr/local/share/ca-certificates</code></pre></li><li><p>The variable syntax in Wharf, <code>${example}</code>, collides with bash, Dockerfiles, and many other systems that has variables. <span class="zettel-link-container folge"><span class="zettel-link" title="2021-03-05T10:42"><a href="different-variable-syntaxes">Different variable syntaxes</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span></p></li><li><p>Security: You can do <code>GET /api/tokens</code> anonymously to get list of all PATs.</p></li><li><p>Security: Data breach on the the DB -&gt; access to all PATs.</p></li><li><p>Security: No login to start a build. Whole system is designed around anonymous access.</p></li><li><p>Jenkins dependency (obviously on this list)</p></li><li><p>RabbitMQ dependency, that is barely even used. (Kalle: I take blame for this one, as I suggested it)</p></li><li><p>API: Mix of plural and singular endpoints, ex: <code>GET /projects/{projectid}/builds</code> vs <code>GET /project/{projectid}</code></p></li><li><p>API: Use of database types as request or response body types, leading to the OpenAPI spec suggesting that <code>POST /project</code> has to specify the project ID.</p></li><li><p>API: Use of <code>OnDelete:RESTRICT</code> instead of <code>OnDelete:CASCADE</code> makes it almost impossible to make fine edits in the database, and error-prone when trying to update it via code.</p></li><li><p>Generated TypeScript projects has horrible automatic naming. Instead of <code>getProjectById</code>, we have <code>projectProjectidGet</code> (the <code>i</code> in <code>id</code> is actually lowercase…)</p></li></ul><h2 id="how-to-resolve">How to resolve</h2><p>Pick and choose. All points needs to be worked through.</p><h2 id="what-wharf-could-shine-with">What Wharf could shine with</h2><ul><li><p>Open source and self hosted: a beautiful combo. Though look at Jenkins, GitLab CI/CD, Argo CD, and then this dies. Other <span class="zettel-link-container folge"><span class="zettel-link" title="2021-04-13T09:10"><a href="similar-products">Similar products</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span> has also been spotted.</p></li><li><p>Lightweight: It’s built with Go, so our Docker images can be based off of <code>scratch</code>, though we still require Jenkins, but that’s something we’re working on.</p></li><li><p>Easy to setup: HAH! Funny. Wharf is the most convoluted CI/CD solution you’ll find on the market when it comes to setting up. Does not need this way, and we’re working on making this easier, but it is the worst at the moment.</p></li><li><p>Run locally, without backend: CircleCI has a lightweight CLI for this, though it’s majorly underpowered, probably intentionally as their project is delivered as a SaaS. If Wharf can pull this off, then this would mean it could even compete with local execution environments such as Cake (C#), Fake (F#), Make, <em>random PowerShell scripts</em>, and those kinds of systems. Writing 1 (one) <code>.wharf-ci.yml</code> file and telling Wharf to either run locally or in Kubernetes would be a huge boost that actually no other (major) CI/CD tooling has shown capability of.</p></li></ul></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2021-02-23T14:57">2021-02-23</time></div></div></article><nav class="ui attached segment deemphasized backlinksPane" id="neuron-backlinks-pane"><h3 class="ui header">Backlinks</h3><ul class="backlinks"><li><span class="zettel-link-container cf"><span class="zettel-link"><a href=".">Wharf architecture</a></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><em>Parent directory zettel</em></div></li></ul></li></ul></nav><nav class="ui attached segment deemphasized bottomPane" id="neuron-tags-pane"><div><span class="ui basic label zettel-tag" title="Tag">root</span></div></nav><nav class="ui bottom attached icon compact inverted menu yellow" id="neuron-nav-bar"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="item" href="https://github.com/iver-wharf/wharf-notes/blob/master/./wharf-sucks.md" title="Edit this page"><i class="edit icon"></i></a><a class="right item" href="impulse" title="Open Impulse"><i class="wave square icon"></i></a></nav></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.33.0" /></a></div></div></div></body></html>